# Technical Roadmap

> Generated by Phase-3 Grounded Architect on 2026-02-19T20:04:37.957Z

**PRD Hash:** `a19159654faeedaceaddbc1c7785c307b486fecb1ab326ed5bd8ba6f3741c028`  **Source:** ../out/sample_prd.md


---

## Summary

| Metric | Value |
|--------|-------|
| Total Steps | 6 |
| Files to Modify | 15 |
| Files to Create | 0 |
| Acceptance Criteria | 2 |
| Risks | 3 |
| Open Questions | 5 |


---

## Acceptance Criteria

- [ ] Unit tests for `ProfilePage`, `useFileUpload` hook, and `userSlice` reducer.
- [ ] E2E test covering the edit and save flow.


---

## Implementation Plan

- **Step 1:** Update shared TypeScript contracts *(Types / modify)*
- **Step 2:** Add / update authentication and authorisation rules *(Auth / modify)*
- **Step 3:** Extend state management (slice / actions / selectors) *(State / modify)*
- **Step 4:** Create or update React hooks *(Hooks / modify)*
- **Step 5:** Integrate feature into UI components / pages *(UI / modify)*
- **Step 6:** Write unit and integration tests *(Tests / test)*


---

### Step 1: Update shared TypeScript contracts

**ID:** step-types-001 | **Area:** Types | **Kind:** modify

Add or extend TypeScript interfaces and types required by the feature. Affected files: src/types/auth.ts.

#### Files to Modify
- `src/types/auth.ts`

#### Blast Radius (Touch / Be Aware)
- `src/components/table/TableRenderer.tsx`
- `src/components/ui/sidebar.tsx`
- `src/hooks/use-mobile.tsx`
- `src/pages/Login.tsx`
- `src/components/authorize/Authorize.tsx`
- `src/components/layout/AppLayout.tsx`
- `src/components/ui/calendar.tsx`
- `src/components/ui/carousel.tsx`

#### Rationale
- Type contracts must be established before any services or UI can use them
- Changing types without updating consumers causes cascading type errors

#### Implementation Checklist
- [ ] Open src/types/auth.ts and locate relevant interfaces
- [ ] Add new fields or types as required by the PRD
- [ ] Ensure all new types are exported and re-exported from index barrel if applicable
- [ ] Add JSDoc comments to new public interfaces
- [ ] Verify no existing consumers of changed types break (check TypeScript errors)

#### Done When
- tsc reports 0 errors for all type files
- All new types have JSDoc
- Barrel re-exports are updated


---

### Step 2: Add / update authentication and authorisation rules

**ID:** step-auth-002 | **Area:** Auth | **Kind:** modify

Extend permission checks, route guards, and auth state for the feature. Files: src/types/auth.ts, src/pages/Login.tsx, src/components/authorize/Authorize.tsx.

#### Files to Modify
- `src/types/auth.ts`
- `src/pages/Login.tsx`
- `src/components/authorize/Authorize.tsx`
- `src/hooks/useAuthorization.ts`
- `src/redux/slices/AuthSlice.ts`
- `src/config/getPagePermissions.ts`

#### Blast Radius (Touch / Be Aware)
- `src/components/table/TableRenderer.tsx`
- `src/components/ui/sidebar.tsx`
- `src/hooks/use-mobile.tsx`
- `src/pages/Login.tsx`
- `src/components/authorize/Authorize.tsx`
- `src/components/layout/AppLayout.tsx`
- `src/components/ui/calendar.tsx`
- `src/components/ui/carousel.tsx`

**Depends on:** `step-types-001`

#### Rationale
- Auth changes must precede UI integration to avoid exposing unguarded routes
- Role/permission models drive what UI elements are rendered

#### Implementation Checklist
- [ ] Review src/types/auth.ts and related auth slice
- [ ] Add any new role or permission constants to src/types/auth.ts
- [ ] Update route guards / HOCs to enforce the new permissions
- [ ] Handle unauthorised state gracefully in UI (redirect or 403 screen)
- [ ] Document the new permission requirements in the file header

#### Done When
- Unauthorised users cannot access the protected route/resource
- Auth unit tests cover the new permission path
- No regressions in existing auth flows


---

### Step 3: Extend state management (slice / actions / selectors)

**ID:** step-state-003 | **Area:** State | **Kind:** modify

Add or modify Redux slices, actions, selectors, or context providers. Files: src/redux/slices/AuthSlice.ts, src/redux/store.ts.

#### Files to Modify
- `src/redux/slices/AuthSlice.ts`
- `src/redux/store.ts`

#### Blast Radius (Touch / Be Aware)
- `src/components/table/TableRenderer.tsx`
- `src/components/ui/sidebar.tsx`
- `src/hooks/use-mobile.tsx`
- `src/pages/Login.tsx`
- `src/components/authorize/Authorize.tsx`
- `src/components/layout/AppLayout.tsx`
- `src/components/ui/calendar.tsx`
- `src/components/ui/carousel.tsx`

**Depends on:** `step-types-001`, `step-auth-002`

#### Rationale
- State must be available before UI components can subscribe to it
- Centralised state prevents prop-drilling and stale data issues

#### Implementation Checklist
- [ ] Open the relevant slice (src/redux/slices/AuthSlice.ts)
- [ ] Define new state shape fields with proper TypeScript interfaces
- [ ] Create actions / reducers for the feature lifecycle (pending/fulfilled/rejected)
- [ ] Add selectors that memoize derived data using createSelector where applicable
- [ ] Register the slice in the root store if it is new
- [ ] Wire async thunks to the matching service functions from the API step

#### Done When
- Redux DevTools shows the new state slice in the store
- Selectors return correct values in unit tests
- No circular imports between slice and service layer


---

### Step 4: Create or update React hooks

**ID:** step-hooks-004 | **Area:** Hooks | **Kind:** modify

Implement custom hooks that encapsulate feature logic. Files: src/hooks/use-mobile.tsx, src/hooks/use-toast.ts, src/hooks/useAuthorization.ts.

#### Files to Modify
- `src/hooks/use-mobile.tsx`
- `src/hooks/use-toast.ts`
- `src/hooks/useAuthorization.ts`
- `src/hooks/useTable.ts`

#### Blast Radius (Touch / Be Aware)
- `src/components/table/TableRenderer.tsx`
- `src/components/ui/sidebar.tsx`
- `src/hooks/use-mobile.tsx`
- `src/pages/Login.tsx`
- `src/components/authorize/Authorize.tsx`
- `src/components/layout/AppLayout.tsx`
- `src/components/ui/calendar.tsx`
- `src/components/ui/carousel.tsx`

**Depends on:** `step-types-001`, `step-auth-002`, `step-state-003`

#### Rationale
- Custom hooks abstract complexity from UI components
- Testing hooks in isolation reduces surface area of component tests

#### Implementation Checklist
- [ ] Create or locate hook file (src/hooks/use-mobile.tsx)
- [ ] Define the hook return type explicitly (do not rely on inference at boundaries)
- [ ] Connect to state selectors and dispatch actions from the state step
- [ ] Handle loading, error, and empty states
- [ ] Write a minimal test using renderHook from @testing-library/react

#### Done When
- Hook is importable and returns typed data
- renderHook test passes for happy path
- No console errors in hook lifecycle


---

### Step 5: Integrate feature into UI components / pages

**ID:** step-ui-005 | **Area:** UI | **Kind:** modify

Update pages and components to surface the new feature. Files: src/components/ui/avatar.tsx, src/components/ui/form.tsx, src/components/table/TableRenderer.tsx.

#### Files to Modify
- `src/components/ui/avatar.tsx`
- `src/components/ui/form.tsx`
- `src/components/table/TableRenderer.tsx`
- `src/components/ui/sidebar.tsx`
- `src/hooks/use-mobile.tsx`
- `src/pages/Login.tsx`

#### Blast Radius (Touch / Be Aware)
- `src/components/table/TableRenderer.tsx`
- `src/components/ui/sidebar.tsx`
- `src/hooks/use-mobile.tsx`
- `src/pages/Login.tsx`
- `src/components/authorize/Authorize.tsx`
- `src/components/layout/AppLayout.tsx`
- `src/components/ui/calendar.tsx`
- `src/components/ui/carousel.tsx`

**Depends on:** `step-types-001`, `step-auth-002`, `step-state-003`, `step-hooks-004`

#### Rationale
- UI is the last layer to integrate; all lower layers must be stable first
- Handling loading/error/empty prevents blank screens in production

#### Implementation Checklist
- [ ] Open target page/component (src/components/ui/avatar.tsx)
- [ ] Import and call the hook from the hooks step
- [ ] Render loading skeleton while data is fetching
- [ ] Render error state with retry action if the request fails
- [ ] Render empty state when data collection is empty
- [ ] Add data-testid attributes to key interactive elements
- [ ] Ensure all text strings are internationalisation-ready (i18n keys or constants)

#### Done When
- Feature renders correctly in the browser for all states (loading/data/error/empty)
- No TypeScript errors in component files
- Accessibility: interactive elements have aria-labels


---

### Step 6: Write unit and integration tests

**ID:** step-tests-006 | **Area:** Tests | **Kind:** test

Add test coverage for all new and modified code. Key files: src/components/ui/aspect-ratio.tsx.

#### Files to Modify
- `src/components/ui/aspect-ratio.tsx`

#### Blast Radius (Touch / Be Aware)
- `src/components/table/TableRenderer.tsx`
- `src/components/ui/sidebar.tsx`
- `src/hooks/use-mobile.tsx`
- `src/pages/Login.tsx`
- `src/components/authorize/Authorize.tsx`
- `src/components/layout/AppLayout.tsx`
- `src/components/ui/calendar.tsx`
- `src/components/ui/carousel.tsx`

**Depends on:** `step-types-001`, `step-auth-002`, `step-state-003`, `step-hooks-004`, `step-ui-005`

#### Rationale
- Tests prevent regressions as the codebase evolves
- Tests serve as living documentation of expected behaviour

#### Implementation Checklist
- [ ] Create test file(s) alongside changed code (src/components/ui/aspect-ratio.tsx)
- [ ] Cover the happy path for every public function or component
- [ ] Cover at least one error/edge-case scenario per function
- [ ] Mock external services and API calls to keep tests deterministic
- [ ] Assert on meaningful output, not implementation details
- [ ] Ensure test suite runs in CI without network access

#### Done When
- All new tests pass: `npm test`
- Code coverage for new files >= 80%
- No test uses real network calls (all mocked)


---

## Artifact Inventory

### Files to Modify
- `src/types/auth.ts`
- `src/pages/Login.tsx`
- `src/components/authorize/Authorize.tsx`
- `src/hooks/useAuthorization.ts`
- `src/redux/slices/AuthSlice.ts`
- `src/config/getPagePermissions.ts`
- `src/redux/store.ts`
- `src/hooks/use-mobile.tsx`
- `src/hooks/use-toast.ts`
- `src/hooks/useTable.ts`
- `src/components/ui/avatar.tsx`
- `src/components/ui/form.tsx`
- `src/components/table/TableRenderer.tsx`
- `src/components/ui/sidebar.tsx`
- `src/components/ui/aspect-ratio.tsx`


---

## Verification Suite

### TYPECHECK
- [ ] Run: npx tsc --noEmit
- [ ] Expected: 0 errors
- [ ] If there are errors, resolve them before proceeding to lint

### LINT
- [ ] Run: npx eslint src --ext .ts,.tsx --max-warnings 0
- [ ] Expected: 0 warnings, 0 errors
- [ ] Auto-fix safe issues with: npx eslint src --fix

### UNIT TEST
- [ ] Run: npm test (or npx vitest / npx jest depending on the project setup)
- [ ] Expected: all existing and new tests pass
- [ ] Check coverage report for new files: target >= 80%

### INTEGRATION TEST
- [ ] Start the dev API server / use MSW (Mock Service Worker) fixtures
- [ ] Exercise the feature end-to-end: create, read, update, delete flows
- [ ] Verify auth flows: login, logout, token refresh, unauthorised access

### MANUAL
- [ ] Open the app in a browser (npm run dev)
- [ ] Log in with a user that has the appropriate permissions
- [ ] Navigate to the feature and exercise all user stories from the PRD
- [ ] Verify loading state appears during data fetch
- [ ] Verify error state appears when the API returns an error (use network throttling)
- [ ] Verify empty state renders correctly when there is no data
- [ ] Log in as a user WITHOUT permission; confirm they cannot access the feature
- [ ] Check browser console: 0 errors, 0 unhandled promise rejections


---

## Risks

### ðŸ”´ HIGH: Large blast radius: 36 secondary/dependent files may be affected by changes

#### Mitigation
- Run the full test suite after each step, not just at the end
- Use TypeScript's '--noEmit' flag frequently to catch cascading type errors early
- Consider introducing the change behind a feature flag for gradual rollout

### ðŸ”´ HIGH: Auth changes can break access control for all users if misconfigured

#### Mitigation
- Test with multiple user roles explicitly
- Ensure logout + token refresh still works correctly
- Do not merge without a security review

### ðŸŸ¡ MEDIUM: State shape changes can cause stale Redux cache or selector mismatches

#### Mitigation
- Version or migrate persisted state if redux-persist is used
- Check all selectors that read from modified slices


---

## Open Questions (Blocking)

**[q-scope-1]** ðŸš§ BLOCKING Which user roles or personas are primarily affected by this change?
  - Scope of impacted users affects which auth/permission files need changes.
  - This question was marked required in the phase-2 clarification bridge

**[q-data-1]** ðŸš§ BLOCKING Does this change introduce new data entities or modify existing schemas?
  - Schema changes cascade to types/, API layer and state management.
  - This question was marked required in the phase-2 clarification bridge

**[q-api-1]** ðŸš§ BLOCKING Are new API endpoints required, or are existing endpoints being modified?
  - Determines scope in services/api layer.
  - This question was marked required in the phase-2 clarification bridge

**[q-auth-1]** ðŸš§ BLOCKING Does this feature require new authentication or authorisation rules?
  - Auth/session changes have a wide blast radius.
  - This question was marked required in the phase-2 clarification bridge

**[q-tbd-1]** ðŸš§ BLOCKING The PRD contains unresolved items marked as "TBD" or "TBA". Please clarify these before implementation starts.
  - Unresolved PRD items lead to rework.
  - This question was marked required in the phase-2 clarification bridge


---

## Notes

- Generated by MockPlanningEngine (deterministic mock â€“ no LLM used)
- Phase-2 identified 40 impacted files across 5 area(s)
- Plan contains 6 ordered steps
- Analyzed using MockAIEngine (heuristics-only, no external API).
- PRD tokens extracted: 157.
- Search index docs scanned: 329.
- Symbol index entries scanned: 293.
- Ambiguity signals detected: should, maybe, tbd, tba, unknown, to be confirmed, ?.
